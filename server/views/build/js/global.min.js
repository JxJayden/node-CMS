!function(){({bindEvent:function(){var e=this;$("body").on("blur","input.search",function(){var e=$(this).val(),o=~window.location.href.indexOf("language=en")?"&language=en":"";if(!e)return!1;window.location=window.location.origin+"/search.html?keywords="+e+o}),$("body").on("click",".to-search",function(){var e=$(this).prev("input").val(),o=~window.location.href.indexOf("language=en")?"&language=en":"";if(!e)return!1;window.location=window.location.origin+"/search.html?keywords="+e+o}),$("body").on("focus","input.search",function(){var e=this;$(document).keyup(function(o){if(13==o.which){var t=$(e).val(),i=~window.location.href.indexOf("language=en")?"&language=en":"";if(!t)return!1;window.location=window.location.origin+"/search.html?keywords="+t+i}})}),$("body").on("click",".card-star",function(){$(this).parents(".card-item").data("id");"star-on"===$(this).attr("id")?($(this).parent().children("#star-on").addClass("card-star-hide"),$(this).parent().children("#star-off").removeClass("card-star-hide"),e.ProductToQuote($(this).data("id"),"del")):($(this).parent().children("#star-off").addClass("card-star-hide"),$(this).parent().children("#star-on").removeClass("card-star-hide"),e.ProductToQuote($(this).data("id"),"add"),e.showDialog())}),$("body").on("click",".choose-card-addcombo",function(){var o=$(this).attr("combo"),t=$(this).data("name")?$(this).data("name"):"BEST CHOOSE",i=$(this).data("english")?$(this).data("english"):"BEST CHOOSE",n=$(this).parent().parent(".card-item").find(".item-title"),a=[];n.each(function(){a.push($(this).data("id"))});var c={combo:o,name:t,englishName:i,product:a};e.comboToQuote(c,"add")}),$("body").on("click",".delete-product",function(){var o=$(this).data("id");e.ProductToQuote(o,"del")}),$("body").on("click",".delete-combo",function(){var o=$(this).attr("combo"),t={combo:o};e.comboToQuote(t,"del")}),$("body").on("click",".remove-all",function(){e.removeAll()}),$("img").error(function(){$(this).attr("src","http://ohnpdrepj.bkt.clouddn.com/%E9%BB%98%E8%AE%A4%E5%8A%A0%E8%BD%BD%E9%94%99%E8%AF%AF.png")}),$(".love-remove-all").click(function(){e.removeAll()}),$(".product").mouseover(function(){$(".slide-down").css("bottom","-225px")}).mouseout(function(){$(".slide-down").css("bottom","10px")}),$(".slide-down").mouseout(function(){$(this).css("bottom","10px")}).mouseover(function(){$(".slide-down").css("bottom","-225px")}).children().mouseover(function(){$(".slide-down").css("bottom","-225px")}),$(".open-slide-down").click(function(){var e=$(window).height()-$("slide-down").height()-65;$(".mobile-navbar-cover").css("height",e+"px"),$(".slide-down").slideDown("fast",function(){setTimeout(function(){$(".open-slide-down").hide(),$(".open-slide-up").show()},100)})}),$(".open-slide-up,.mobile-navbar-cover").click(function(){$(".mobile-navbar-cover").css("height","0"),$(".open-mobile-search").show().next().hide(),$(".slide-down").slideUp("fast",function(){setTimeout(function(){$(".open-slide-down").show(),$(".open-slide-up").hide()},100)})}),$(".product").click(function(){$(".product-slide-down").not($(this).next()).slideUp(),$(this).next(".product-slide-down").slideToggle()}),$(".select-language").click(function(e){var o=window.location.href;if($(this).hasClass("select-language-acitve"))return!1;"cn"===$(this).data("language")?o=~o.indexOf("?language=en")?"?language=en"===window.location.search?o.replace("?language=en",""):o.replace("?language=en","?"):o.replace("&language=en",""):~o.indexOf("?")?o+="&language=en":o+="?language=en",window.location=o});var o={open:function(){$(".pc-love").addClass("select"),$(".love-container").css("right","0px"),$("body").append('<div class="love-mask" style="width:100%;height:100%;position:fixed;z-index:250;left:0;top:0;background: #000 !important;opacity: 0.7 !important;"></div>')},close:function(){$(".love-container").css("right","-340px"),$(".pc-love").removeClass("select"),$(".love-mask").remove()}};$(".pc-love").click(function(){"0px"===$(".love-container").css("right")?o.close():o.open()}),$(".close-love").click(function(){o.close()}),$("body").on("click",".love-mask",function(){o.close()})},delStar:function(e){if(/(search)|(equip-product)|(part-product)/i.test(window.location.href)){var o=$(".card-star");e?o.each(function(){$(this).data("id")===e&&($(this).parent().children("#star-on").addClass("card-star-hide"),$(this).parent().children("#star-off").removeClass("card-star-hide"))}):o.each(function(){$(this).parent().children("#star-on").addClass("card-star-hide"),$(this).parent().children("#star-off").removeClass("card-star-hide")})}},ProductToQuote:function(e,o){var t=this,i=store.get("quote").product;if(i){if("add"===o){if(~i.indexOf(e))return;i.push(e),t.setQuoteStage("product",i),t.updateProductTemplate(e,o)}else if("del"===o){if(!~i.indexOf(e))return;i.splice(i.indexOf(e),1),t.setQuoteStage("product",i),t.updateProductTemplate(e,o)}}else t.setQuoteStage("product",[]),t.ProductToQuote(e,o)},updateProductTemplate:function(e,o){var t=this;if("del"===o)~window.location.href.indexOf("quote.html")?($("#quote-list").find(".product-item[product="+e+"]").remove(),$("#nav-list").find("li[product="+e+"]").remove()):$("#nav-list").find("li[product="+e+"]").remove(),t.delStar(e);else if("add"===o){var i=[e];$.post("/api/product/arr",{arr:JSON.stringify(i)},function(e){var o=e;o.chinese=!~window.location.search.indexOf("language=en");var t=template("nav-quote-product",o);if($("#nav-list").append(t),~window.location.href.indexOf("quote.html")){var i=template("quote-product",o);$("#quote-list").append(i)}})}},comboToQuote:function(e,o){var t=this,i=store.get("quote").combo;if(i){if("add"===o){for(var n=!1,a=0;a<i.length;a++)i[a].combo===e.combo&&(n=!0);if(n)return void t.showDialog();i.push(e),t.setQuoteStage("combo",i),t.updateComboTemplate(e,o),t.showDialog()}else if("del"===o){for(var a=0;a<i.length;a++)if(i[a].combo===e.combo)var c=a;if(!~c)return;i.splice(c,1),t.setQuoteStage("combo",i),t.updateComboTemplate(e,o)}}else t.setQuoteStage("combo",[]),t.comboToQuote(e,o)},updateComboTemplate:function(e,o){if("del"===o)~window.location.href.indexOf("quote.html")?($("#quote-list").find(".product-item[combo="+e.combo+"]").remove(),$("#nav-list").find("li[combo="+e.combo+"]").remove()):$("#nav-list").find("li[combo="+e.combo+"]").remove();else{var t=[e],i={list:t,chinese:!~window.location.search.indexOf("language=en")},n=template("nav-quote-combo",i);if($("#nav-list").append(n),~window.location.href.indexOf("quote.html")){var a=template("quote-combo",i);$("#quote-list").append(a)}}},removeAll:function(){store.get("quote");~window.location.href.indexOf("quote.html")?($("#quote-list").empty(),$("#nav-list").empty()):$("#nav-list").empty(),this.setQuoteStage("product",[]),this.setQuoteStage("combo",[]),this.delStar()},setQuoteTemplate:function(){var e=store.get("quote");if(e.combo.length>0){var o={list:e.combo,chinese:!~window.location.search.indexOf("language=en")},t=template("nav-quote-combo",o);if($("#nav-list").append(t),~window.location.href.indexOf("quote.html")){var i=template("quote-combo",o);$("#quote-list").append(i)}}e.product.length>0&&$.post("/api/product/arr",{arr:JSON.stringify(e.product)},function(e){var o=e;o.chinese=!~window.location.search.indexOf("language=en");var t=template("nav-quote-product",o);if($("#nav-list").append(t),~window.location.href.indexOf("quote.html")){var i=template("quote-product",o);$("#quote-list").append(i)}})},showDialog:function(e){var o=this;$(".dialog").length<=0?($("body").append([' <div class="dialog">','<div class="dialog-overlay"></div>','<div class="dialog-alert">','<div class="dialog-img"><img width="50%" src="//ohnpdrepj.bkt.clouddn.com/star-succeed.png"></div>',"<div>","收藏商品成功！","</div>",'<button class="dialog-btn">OK</button>',"</div>"," </div>"].join("")),$("body").on("click",".dialog-btn",function(){o.hideDialog()})):$(".dialog").show()},hideDialog:function(){$(".dialog").hide()},setQuoteStage:function(e,o){var t=store.get("quote"),i=this;t?t.updateTime||t.createTime:new Date;if(t&&t.createTime)if(o&&e)try{store.transact("quote",function(t){t[e]=o,t.updateTime=new Date})}catch(e){console.log(e)}else t.localStorageNew||i.setQuoteStage("localStorageNew",!0);else{store.remove("quote");try{store.set("quote",{product:[],combo:[],createTime:new Date,updateTime:new Date,timeValuation:94608e6,localStorageNew:!0})}catch(e){console.log(e)}}},testLocalStage:function(){store.enabled||alert("Local storage is not supported by your browser. Please disable 'Private Mode', or upgrade to a modern browser.")},init:function(){var e=this;FastClick.attach(document.body),template.config("openTag","<%"),template.config("closeTag","%>"),e.testLocalStage(),e.bindEvent(),e.setQuoteStage(),e.setQuoteTemplate()}}).init()}();